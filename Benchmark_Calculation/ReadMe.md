### Benchmark calculation using hierarchical partitioning

We need to get the numbers when we are choosing either of the below as hierarchical partition key:

`tenantId` + `siteId` + `deviceId`
`deviceId` + `date` ( as recommended here : https://youtu.be/oToAY8NGWA0?t=1425)
For us, deviceId will be `manufacturer name` and `serial number`.

- Each device can exceed 20GB of data
- No need to implement synthetic keys


Let's consider some numbers to calculate benchmark: 

- 1 device generates nearly ~=2 Lac records per month
- We need to consider `1 year` TTL for such records

Let's create collections for `15 tenants` each having `100 sites`.
Each site would have `5 devices` generating a `~5 KB` document every `30th sec`.
Devices will only only be active for 12 hrs (considering only US hours).

#### What will be the number of telemetry generated every day by 100 sites?

> 1 tenant 100 sites 1 day | Records Generated

```
100 sites * 120 requests per hour * 12 hours
=  100 * 1440 (1 device generating telemetry for 12 hours -US consideration - generating telemetry every 30 secs)
Number of telemetry requests generated by 1 device each , for 100 sites in a day =   144000
 
For 5 devices = 144000*5 => 720,000
```

> 1 tenant 5000 sites telemetry for 1 day

```
5000 sites * 120 requests per hour * 12 hours
=  5000 * 1440 (1 device generating telemetry for 12 hours -US consideration - generating telemetry every 30 secs)
Number of telemetry requests generated by 1 device each , for 100 sites in a day = 7,200,000
 
1 device in a month = 216 million  = 21.6 crores (furcating based on partition key)
5 devices in a day= 7,200,000*5 => 36,000,000 (5 devices in 5000 sites generating telemetry for 12 hrs in a day)
5 devices for a month : one billion eighty million (108 crores)
Two tenants with 5 devices each : 216 crores
```

#### What should be the storage requirements for storing 720,000 records?
Considering each document stored in cosmos collection has `~5KB` size.

> For 1 tenant 100 sites 1 day | Size Requirements

```
Total size required for 1 day = (720,000 * 5)/1024*1024 => 3.43GB ~=3.5GB per day
 
For 1 day , size requirement = 3.5 GB
For 2 days, size requirement = 7 GB
For 3 days, size requirement = 10.5GB
For 4 days, size requirement = 14GB
For 5 days, size requirement = 17.5GB
For 6 days, size requirement = 21GB
For 7 days, size requirement = 24.5GB
For month , size requirement = 105 GB per month
```

---

#### Write RU/s Benchmark Calculator

- Helps in writing a specified document (given in `Player.json`) to a specified collection whose partition key can be user specified in `KeyValue.json`.
- Local cosmos connection is configured using `app.config`
- App is configured to use infinite number of threads. DegreeOfParallelism is set to `-1`.
- Sample output is herewith [attached](https://github.com/napsterhopes/AZ/blob/main/CosmosDB/Benchmark_Calculation/Output_1_Site_5_Devices_7200_docs.log)

#### [Performance and scale testing](https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/performance-testing?WT.mc_id=docs-azuredevtips-azureappsdev)
#### [Find the request unit charge](https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/find-request-unit-charge?source=recommendations&tabs=dotnetv3)

- https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/query-metrics
- https://learn.microsoft.com/en-us/azure/cosmos-db/optimize-cost-reads-writes



